My SQL

1. 一个数据库包括多张表，每个表中多条数据记录，所有记录同分若干字段。在数据库的概念里，一个个的表就称为“数据（Table）”。专业数据库软件包含数据库、数据表、记录、字段或属性等数据。在专业的数据库软件中，给每条记录都增加数值唯一、禁止重复的字段，即可避免出现完全相同的记录。被指定为标识的唯一性字段称为“主键”。所有以二维表模式为核心的数据库称为“关系型数据库系统”，除此之外，还有其他“非关系型数据库（NoSQL）”。

2. 在Navicat或HeidiSQL等图形化数据库工具中，点击“新建查询”后就可以在编辑器中编写SQL语句了。

   从表中查询数据使用SELECT语句，语法格式为：
   SELECT 字段名 FROM 表名;字段名表示需要查询的列名，表名表示从哪张表里面查询。

3. 关键字有特殊定义，为表和列命名时应该尽量避免使用关键字。如果需要查询的表名和列名跟SQL关键字同名，在MySql数据库中，可以使用反引号指明那些与关键字重名的表或列名，例如：select from person 。

   在SqlServer中，则要改用方括号指明那些与关键字重名的表或列名：select [from] from person 。
   在Oracle中，使用双引号 "from" 表示查询的字段名。

4. DISTINCT关键字用于在查询结果中进行去重, DISTINCT修饰的不是某一个字段，而是它后面所有字段组合后的记录。

5. ORDER BY子句用于在查询结果中进行排序, e.g. select * from 报销记录 order by 报销金额, 在ORDER BY字段名的后面加入 DESC 关键字, 表示从大到小降序排序。

6. LIMIT 关键字用于在查询结果中限定记录的数量， LIMIT n OFFSET m 子句用于在查询结果中跳过前面m行，然后再获取n条记录作为最终结果。例如：select * from 报销记录 order by 报销金额 desc limit 4 offset 2，该语句表示在查询结果中跳过前2行，在剩下的记录中获取前4条记录。

7. WHERE 子句表示从数据表中查找指定特征的记录，WHERE 需要写在 FROM 之后的位置指定筛选的条件。在SQL语句中如果想表示文本内容，必须使用半角单引号，将其表示为字符串。例如： select * from person WHERE staff_name = '张进'。

8. SQL语句的子句顺序为：SELECT 字段 FROM 表名 WHERE 筛选条件 ORDER BY 排序字段 LIMIT 记录数量。

9. NULL 关键字代表该字段为空，判断一个字段是否为 NULL，不能使用等号，而要使用一个特殊的关键字 IS。例如查询 sale_amount是NULL的所有记录：select * from person where sale_amount is null 。

10. 与四则运算中的“先乘除、后加减”一样，“与”、“或”、“非”等逻辑操作符混合在一起时，也具有优先级顺序，具体为：NOT > AND > OR

11. IN 关键字表示在过滤条件中设置多个值，比如：x in (a, b, c, ...) ，只要x的值等于括号中的任何一项，即视为符合条件，相当于 x=a or x=b or x=c 。

12. 在 LIKE 子句中使用通配符才能实现真正的模糊查询，百分号“%”在与 LIKE 搭配使用时，代表“任意多个任意字符”。例如 '%鸡' 表示前面是任意多个任意字符以鸡结尾的记录。如果查找的条件是只要包含某字符而不论该字符出现的位置，那么在该字符的前后加上“%”即可。“%”虽然可以表示任意个数的字符，但是不能准确限制字符的个数。下划线“_”可以代表任意字符串，但是只代表一个。如果需要查询的字符是“%”或“_”本身，应该使用反斜线“\”对通配符进行转义，将其变为普通字符。例如：'%\%'表示查询字符串中以'%'结尾的记录。

13. 可以将计算字段写在 SELECT 后面，相当于在结果中添加一个原表中没有的“自定义列”。例如：select team, GS-GA from football
    GS-GA将作为新的字段显示在结果中；如果想既显示原表中的数据，又想显示计算字段的数据，可以将计算字段写在“*”后面作为查询的字段，例如：select *, GS-GA from football WHERE (GS-GA) > 1；可以使用 AS 关键字，对 SELECT 的任何字段（包括自定义列）分别起“别名”。

14. SQL语句的执行过程是：FROM -> WHERE -> SELECT -> ORDER BY 

15. CONCAT(s1, s2, ...)函数将参数中的字符串拼接到一起，它的功能类似于SQLServer等数据库中使用加号连接字符串。例如：
      select concat(team, '(', game, ')') as 完整名称 from football

16. 数据库中常见的字符串处理函数有：
      LEFT(s, x)：获取字符串s左边x位
      RIGHT(s, x)：获取字符串s右边x位
      LENGTH(s)：计算s的长度，即字符个数或占用字节数，具体取决于数据库软件品牌。
      LEN(s)：同 LENGTH(s)
      TRIM(s)：去掉s两端的空格
      UPPER(s)：将s中字母全变为大写
      LOWER(s)：将s中字母全变为小写

17. 数据库中常见的数学函数有：
      ABS(x)：x的绝对值，较常用
      COS(x)：x的余弦值
      EXP(x)：e的x次幂
      PI()：返回圆周率
      SIN(x)：x的正弦值
      SQRT(x)：x的平方根，较常用
      TAN(x)：x的正切值

18. MYSQL、SQLServer等常见数据库中都有名为 DATETIME 的类型，可以保存“日期+时间”形式的完整时间数据。在SQL语句中书写具体日期时间数值，必须用单引号括起来。在MYSQL中日期类型虽然有单引号，但是它并不是字符串类型，'2020-09-04 15:19:53'与'2020/09/04 15:19:53'这两种写法是等价的。

19. 日期类型与数字类型一样，可以使用关系操作符进行比较。BETWEEN 关键字与 AND 关键字配合使用表示在两者之间，处理区间条件的时候 BETWEEN 比 条件操作符可读性更好。

20. MySQL中常用的时间函数有：
      DATE(d)：获取d代表的日期、忽略秒分时，效率比使用 BETWEEN 或比较操作符低。
      YEAR(d)：从日期d取得年份数字
      MONTH(d)：取得d的月份数字
      DAY(d)：取得d的日数字
      HOUR(d)：取得d的小时数字
      MINUTE(d)：取得d的分钟数字
      SECOND(d)：取得d的秒数
      DATEDIFF(d1, d2)：计算d1和d2相差多少天

    大多数日期函数的结果是数字类型，而不是日期类型，例如：select * from 收入 where month(时间) = 9，结果是数字9，而不是'2020-09'。而DATE 函数的结果是日期类型。在进行日期比较时需要注意函数结果的类型。

    日期类型的值不能直接通过加减计算，DATEDIFF 函数专门用于计算日期之间的差值。在MySQL中该函数只能用于计算日期之间相差的天数，而不能计算相差的时分秒。

21. 在SQL中 GROUP BY 子句表示按照指定字段（或计算字段、函数等）对记录进行分组，GROUP BY 分组后可以使用聚集函数，对每一组数据分别进行统计，select funs_id, sum(money) as 总额 from income group by funs_id ，表示根据funs_id进行分组，对每一组中的多条money记录进行求和，也就是对每一组分别进行求和。如果分组时发现有 NULL 值，则 NULL 值的记录单列一组。

22. 多层（嵌套）分组可以对第一层分组后的每一组数据再进行分组，例如按照“人名+礼物”分组，表示同一个人并且同一种礼物的记录，分为一组进行统计。嵌套分组只需在 GROUP BY 子句中按照分组的先后顺序用逗号隔开即可：
      select funs_id, gift_level, sum(money) as 总额
        from income
        group by funs_id, gift_level

23. 如果使用了 WHERE 与 ORDER BY 子句，GROUP BY 子句应该写在 WHERE 子句之后，ORDER BY 子句之前，SQL语句的整体书写顺序为：SELECT -> FROM -> WHERE -> GROUP BY -> ORDER BY 。

24. 分组查询的注意事项：
      WHERE子句必须写在GROUP BY子句之前；
      WHERE子句中不允许使用聚集统计函数；
      分组后使用HAVING筛选分组，而不是WHERE。

25. HAVING 子句对分组后的数据进行过滤，分组后选出符合条件的组。
    HAVING 的用法和 WHERE 用法类似，区别在于 HAVING 子句必须写在 GROUP BY 分组之后，执行顺序也在分组之后，HAVING 可以使用聚合函数。

26. SQL允许在一个查询里写多条独立的互不相关的SQL语句，中间用分号“;”隔开，例如一次查询两张表内的所有记录：
      select * from student;
      select * from punish

27. 非关联子查询是指两层查询互不依赖，即使删除外面的查询，里面的查询也能执行；关联子查询是指内层查询依赖于外层。如果删除外面的查询，里面的查询无法执行。

    关联子查询与非关联子查询执行顺序的区别：
      \1. 非关联子查询：先内后外，内层执行完毕得到一个列表，然后执行外层。
      \2. 关联子查询：先外后内。外层找一条记录，就执行一次子查询；然后外层再找一条记录，接下来再执行一次子查询......

28. 4.在同一张表上应用子查询的过程：
      \1. 先写外层查询，即最终要显示哪个表的哪些字段。
      \2. 发现要用到表中没有的信息（例如总计金额），于是在需要的地方写一个子查询。
      \3. 用 AS 给两层查询中的同一张表各起一个别名，从而在需要时能够分清。

29. 在SQL中 JOIN ON 关键字用于将相互关联的表根据一定的条件进行连接，创建出一张新的虚拟表。在SQL中除了内连接之外还有左连接、右连接等其他形式的连接，由于内连接是最常用的一种形式，所以 JOIN 语句默认使用内连接。为了区别于其他形式的连接，建议进行内连接的语句编写时使用 INNER JOIN。

      select *
        from student inner join score
        on student.s_id = score.s_id

    SQL为内连接提供了简化写法，使用逗号表示 JOIN, WHERE 表示 ON。例如：
      select A.s_id, s_name, email, c_id, score
        from student as A, score as B
        where A.s_id = B.s_id

30. inner join 不只可以根据单一的字段进行关联，对于两个表之间需要通过两个或更多字段相关联的情况，可以使用 AND 将所有需要的关联条件相连接

31. 需要查询的字段分别在两张以上的表中时，需要连接多张表进行查询。

    INNER JOIN 在使用时遵循的原则：
      \1. 每个 INNER JOIN 只能连接两张表；
      \2. 多次 INNER JOIN 可以连接多张表；
      \3. 过多连接会影响性能，一般不超过3层。

32. 在SQL连接查询中，包含表中没有关联行的那些记录的连接方式称为外连接。外连接分为左连接、右连接、全外连接。确保左表中的记录全部出现在结果中，即使填充 NULL，这种外连接的形式称为左连接。左连接的运行过程是：先执行内连接得到一次结果；检查左表是否还有“漏掉”的记录。

33. 讲多个SQL语句的执行结果合并到一张结果表中称为联合（UNION）。如果用 UNION 将两个查询结果连在一起，两个查询结果中的字段名称可以不同，但是字段数目和类型必须相同，例如联合student与left_student：
      select s_id, s_name, email from student
      union
      select s_id, s_name, contact from left_student

    如果两个查询结果有重叠，UNION 之后会去除重复、只保留其中一个。使用 UNION ALL 可以不去除重复，保留两个结果中的全部内容。

34. SHOW DATABASES 语句用于显示所有数据库的名字。查看某数据库中的数据表，首先需要指定使用哪个数据库，语句为： USE 数据库名。接下来就可以显示当前数据库中的所有数据表，语句为：SHOW TABLES 。

35.  CREATE DATABASE 数据库名 语句用于创建数据库，例如创建一个名为bank的数据库：CREATE DATABASE bank 。

    如果已经存在一个名为“bank”的数据库，再次运行 CREATE DATABASE 会出错，在MySQL中可以通过 CREATE DATABASE IF NOT EXISTS bank 语句来处理，如果不存在 bank 再创建。在数据库内创建表时首先确定当前使用的数据库是否是需要建表的库，如果不是需要使用 USE 语句先使用需要建表的数据库，然后使用 CREATE TABLE 语句建表，建表语句的基本语法为：

      CREATE TABLE 表名 (

    ​    字段名1 类型, 

    ​    字段名2 类型, 

    ​    字段名3 类型, 

    ​    ...)"

对于不允许出现空值的字段，在建表时可以为该字段添加 NOT NULL 的约束; 对于允许出现空值的字段，可以不加任何约束，或者在类型后添加 NULL;当字段设置为不允许为空，但是插入数据时又不确定真正的值时，可以为字段设置默认值。当插入记录时如果不指定值将使用 DEFAULT 设置的默认值，例如设置sname的默认值为'待调查', 主键用于保证数据表中每一条记录都有唯一的标识，建表时可以通过 PRIMARY KEY 指定某字段为主键，例如指定id字段为主键：

  CREATE TABLE student (

​    id int NOT NULL, 

​    sname varchar(10) NOT NULL DEFAULT '待调查',

​    PRIMARY KEY (id)

​    )"

36. DROP 语句用于删除数据库或数据表，DROP DATABASE 库名 删除数据库；DROP TABLE 表名 删除数据表。删除数据库或表的操作执行成功后没有任何提示信息，请谨慎使用。

37. 在MySQL中数据类型划分为：数字、文本、时间、二进制，四大类型中每一种又分为若干具体的小类型。

    数字类型分为8种具体类型，它们分别是：

      TINYINT    （微小整数，1字节，-128 ~ 127）TINYINT 类型在大数据集中能够大量节省存储空间

      SMALLINT   （小型整数，2字节，-32 768 ~ 32 767）

      MEDIUINT   （中型整数，3字节，-8 388 608 ~ 8 388 607）

      INT        （普通整数，4字节，-2 147 483 648 ~ 2 147 483 647）

      BIGINT     （巨大整数，8字节，-9 223 372 036 854 775 808 ~ 9 223 372 036 854 775 807）

      FLOAT      （单精度浮点数，4字节，表示小数、或科学计数法形式的整数）

      DOUBLE    （双精度浮点数，8字节，比 FLOAT 范围更大）

      **DECIMAL   （十进制数字，16字节，避免转换误差）**用法：DECIMAL(m, n) 本数字最多m位，其中小数占n位。

由于计算机统一将数字保存为二进制，为了存储浮点数计算机采取截断的方式保留n位小数，截断后的二进制值再转换回十进制就不再与转换之前的浮点数完全相等，具有微小的差别，导致精度损失问题。DECIMAL 类型的数字在进行算数运算的过程中完全按照十进制方式处理，而不是以计算机默认的二进制方式处理，没有精度损失。

38. 文本类型分为以下几种：

      CHAR      （最大256字节）

      VARCHAR   （最大65535字节）

      TINYTEXT   （最大256字节）

      TEXT       （最大65535字节）

      MEDIUMTEXT （最大16M字节）

      LONGTEXT   （最大4G字节）

    CHAR 类型是最基本的文本类型，在建表时需要指定 CHAR 类型字段的长度是多少，例如最多存储4个字符：CHAR(4) ; 当数据库中某个字段是 CHAR(40)，那么当实际存储的内容少于40个字符时，MySQL会自动在尾部追加空格，凑足40个字符。而在查询时，MySQL会自动忽略尾部空格。VARCHAR 类型表示可边长字符串，可以指定最大字符数，如果实际内容较短，也不会自动填充空格。在实际工作中，使用 VARCHAR 比 CHAR 类型更为常见。除了 CHAR 与 VARCHAR 之外，使用各种 Text 类型存储文本时，文本实际存储在另一个特殊的“表”中，因而容量更灵活。相应地，检索效率也会降低。因此能使用 VARCHAR 满足的文本就尽量不使用 TEXT 类型，如果使用 VARCHAR 无法满足，可以选择 LONGTEXT 类型。

39. 时间类型分为以下几种：

      TIMESTAMP    (时间戳，4字节，1970-01-01 00:00:00 ~ 2038-1-19 11:14:07)

      DATETIME     (混合日期时间，8字节，1000-01-01 00:00:00 ~ 9999-12-31 23:59:59)

      YEAR         (年份，1字节，1901 ~ 2155)

      TIME         (时间，3字节，-838:59:59 ~ 838:59:59)

      DATE         (日期，3字节，1000-01-01 ~ 9999-12-31)

    对于公元1000年之前的日期存储，可以单独使用一个整数型字段将年份单独存储，再使用一个DATETIME类型字段单独保存日期和时间，忽略年份。TIMESTAMP 类型与 DATETIME 类型一样，可以用与存储日期和时间，TIMESTAMP 占用的空间更小。TIMESTAMP 可以自动调整时区，该类型记录的日期时间以系统时区为依据，但是当数据库中所设置的时区与系统时区不同时，TIMESTAMP 将根据数据库的时区自动调整日期时间。而 DATETIME 不受时区影响。

40. INSERT INTO 语句将数据记录插入到数据表中，该语句的基本语法格式为：INSERT INTO 表名 VALUES (字段1的值, 字段2的值, 字段3的值, 字段4的值 ......)；插入数据时，数字值、逻辑值还有 NULL 不用写引号；文本值、日期值需要用单引号括起来。

    将主键设置为自动增长主键（AUTO INCREMENT），自动增长主键在插入数据时将自动计算。例如设置“编号”为自动增长主键：

      CREATE TABLE 邮寄选票(

    ​    编号 INT NOT NULL AUTO_INCREMENT,

    ​    投票人 VARCHAR(40) NOT NULL,

    ​    投给候选人 VARCHAR(40) NOT NULL,

    ​    录入时间 TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

    ​    PRIMARY KEY (编号)

      )

    在 INSERT 语句中可以只输入部分字段的数值，语法格式为：

      INSERT INTO 表名

    ​    (欲插入的字段列表)

      VALUES

    ​    (这些字段对应的值)

    前提：未列入的其他字段，必须自动增长或有默认值。

41.  MySQL常用技巧：对日期时间类型字段选用 TIMESTAMP 类型，并且指定其默认值为 CURRENT_TIMESTAMP ，插入数据时MySQL会自动录入当前时间。

42. INSERT 语句可以跨表复制数据，例如将表格A中的部分或全部数据导入到另一张表格B中，语法格式为：

      INSERT INTO 表B(字段名1, 字段名2, 字段名3, ......)

    ​    SELECT 字段名1, 字段名2, 字段名3, ...... FROM 表A

    SELECT 查询出的结果无论是表A中的字段，还是统计计算的结果，都可以插入到表B中。

43. UPDATE 语句修改已存在的数据记录，语法格式为：

      UPDATE 更新哪张表

    ​    SET 字段1 = 值,

    ​      字段2 = 值 ......

    ​    WHERE 更新哪些记录

    UPDATE 语句中修改字段值时可以使用具体数值，也可以使用计算字段或函数

44. DELETE 语句删除已存在的数据记录，删除操作是针对整条记录，不分字段，所以 DELETE 后面没有任何字段名或星号，其语法格式为：

      DELETE FROM 表名

    ​    WHERE 条件

45. 划分题目类型：先读一遍题目，看看有没有典型的特殊类型的标志性语言，比如：“每个” 与 “最高的三个” 组合为 “分组排名” 问题；查询“某属性” 比 “某属性” 高的 “比较问题”；没有特殊标识的词语，属于 “普通类型” 题目。复核查询结果：注意查询结果中包含 “重复值” 与 “NULL” 的情况，使用 DISTINCT 等相应的语句处理重复值与空值。

46. “比较类问题” 是指在题目中要想完成查询必须找出某属性大于、等于、小于或与什么相同、不同等等这样的数据记录。推荐利用表连接解决比较类的问题；对于同表比较查询，可以使用不同的别名将同一张表标记为不同名的多张表，从而进行连接查询。

    比较问题的解决思路：

      \1. 找到要比较的两个数据；

      \2. 确定两个数据的来源表；

      \3. 对两个数据表执行连接；

      \4. 指定连接和筛选的条件
